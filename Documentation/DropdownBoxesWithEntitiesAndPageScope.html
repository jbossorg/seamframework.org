<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <!-- Mirrored from 127.0.0.1:64444/Documentation/DropdownBoxesWithEntitiesAndPageScope by HTTrack Website Copier/3.x [XR&CO'2008], Wed, 01 Oct 2014 13:47:19 GMT -->
 <!-- Added by HTTrack -->
 <head>
  <meta http-equiv="content-type" content="text/html;charset=UTF-8">
  <!-- /Added by HTTrack -->  
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
  <title>Seam Framework - Drop-down boxes with entities and page scope</title> 
  <link class="component" href="../a4j/s/3_3_3.CR1org/richfaces/renderkit/html/css/basic_classes.xcss/DATB/eAELXT5DOhSIAQ%21sA18_.css" rel="stylesheet" type="text/css">
  <link class="component" href="../a4j/s/3_3_3.CR1org/richfaces/renderkit/html/css/extended_classes.xcss/DATB/eAELXT5DOhSIAQ%21sA18_.css" media="rich-extended-skinning" rel="stylesheet" type="text/css">
  <script src="../a4j/g/3_3_3.CR1org.ajax4jsf.javascript.AjaxScript" type="text/javascript"></script>
  <script type="text/javascript">window.RICH_FACES_EXTENDED_SKINNING_ON=true;</script>
  <script src="../a4j/g/3_3_3.CR1org/richfaces/renderkit/html/scripts/skinning.js" type="text/javascript"></script>
  <link href="../themes/sfwkorg/css/sfwk.css" rel="stylesheet" type="text/css"> 
  <link href="../themes/sfwkorg/css/shCore.css" rel="stylesheet" type="text/css"> 
  <link href="../themes/sfwkorg/css/shThemeDefault.css" rel="stylesheet" type="text/css"> 
  <script type="text/javascript" src="../seam/resource/remoting/resource/remote.js"></script> 
  <script type="text/javascript" src="../seam/resource/remoting/interface1535.js?httpSessionChecker"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/jquery.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/jqueryPlugins.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/lacewiki.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shCore.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushBash.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushCpp.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushCSharp.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushCss.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushDelphi.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushDiff.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushGroovy.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushJava.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushJScript.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushPhp.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushPlain.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushPython.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushRuby.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushScala.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushSql.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushVb.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushXml.js"></script> 
  <script type="text/javascript">
        /* If you really want to load the Flash garbage on every page, go ahead and enable this:
        SyntaxHighlighter.config.clipboardSwf = '/themes/sfwkorg/js/sh/scripts/clipboard.swf';
         */
        SyntaxHighlighter.defaults['gutter'] = false;
        SyntaxHighlighter.all();
	</script> 
  <script type="text/javascript">

        // ###################### Session timeout alert #################################

        var sessionChecker = Seam.Component.getInstance("httpSessionChecker");
        var timeoutURL = '/Home/JBossSeam';
        var timeoutMillis = '900'*1000+3000;
        var sessionTimeoutInterval = null;

        function startSessionTimeoutCheck() {
            sessionTimeoutInterval = setInterval('sessionChecker.isNewSession(alertTimeout)', timeoutMillis);
        }

        function stopSessionTimeoutCheck() {
            if (sessionTimeoutInterval) clearInterval(sessionTimeoutInterval);
        }

        function resetSessionTimeoutCheck() {
            if (sessionTimeoutInterval != null) {
                stopSessionTimeoutCheck();
                startSessionTimeoutCheck();
            }
        }

        function alertTimeout(newSession) {
            if (newSession) {
                clearInterval(sessionTimeoutInterval);
                jQuery(".ajaxSupport")
                        .removeAttr('onblur')
                        .removeAttr('onchange')
                        .removeAttr('onkeyup')
                        .removeAttr('onclick');
                jQuery(".sessionEventTrigger").hide();
                var answer = confirm("Your session has timed out, you will be redirected to the start page.");
                if (answer) window.location = timeoutURL;
            }
        }

        // ###################### Popups #################################

        var fadeInPopupDialog = function(hash) {
            hash.w.fadeIn('fast',function(){ hash.o.show(); });
            jQuery(".closeDialog", hash.w).attr("accesskey", "C"); // Dynamically assign accesskey to .closeDialog buttons
        };

        var fadeOutPopupDialog = function(hash) { hash.w.fadeOut('fast',function(){ hash.o.remove(); }); };

        // ###################### Tabbed Forms #################################

        var formTabErrors = {};

        function formTabRaiseError(tabId, fieldId, message) {

            formTabClearError(tabId, fieldId); // Clear error then re-add

            log("Raise error for tab: '" + tabId + "' field: " + fieldId);

            // Add an error message to the client message box
            log("Adding error message: " +tabId + fieldId + "ErrorMessage")
            jQuery("#clientMessageBoxTable").append(
                '<tr id="' + tabId + fieldId + 'ErrorMessage"><td><img src="/themes/sfwkorg/img/attention.gif" ' +
                'height="18" width="18" class="clientMessageBoxImage attentionImage"/></td>' +
                '<td><span id="attentionMessage" class="attentionMessage">'+ message + '</span></td></tr>'
            );
            if (formTabErrors[tabId] == null) {
                formTabErrors[tabId] = 1;
            } else {
                formTabErrors[tabId]++;
            }
            formTabRenderErrors(tabId);
        }

        function formTabClearError(tabId, fieldId) {
            if (document.getElementById(tabId+fieldId+"ErrorMessage") != null) { // This error is displayed
                log("Clear error for tab: '" + tabId + "' field: " + fieldId);
                log("Removing error message: " +tabId + fieldId + "ErrorMessage")
                // Remove the error message on the client message box
                jQuery("#"+tabId + fieldId + "ErrorMessage").remove();

                formTabErrors[tabId]--;
                formTabRenderErrors(tabId);
            }
        }

        function formTabRenderErrors(tabId) {
            log("Errors for tab: '" + tabId + "': " + formTabErrors[tabId]);

            if (formTabErrors[tabId] > 0 && document.getElementById(tabId+"InvalidIcon") == null) {
                log("Showing icon for tab: " + tabId);
                // Show an icon on the tab and blink it a few times
                jQuery("#"+tabId)
                    .prepend('<img id="' + tabId + 'InvalidIcon" ' +
                            'src="/themes/sfwkorg/img/attention.gif" width="13" height="13" ' +
                            'alt="!" style="vertical-align:bottom;margin-left:5px;margin-right:5px;"/>');
                pulsate("#"+tabId);
            } else if (formTabErrors[tabId] < 1){
                log("Removing icon of tab: " + tabId);
                jQuery("#"+tabId + "InvalidIcon").remove();             // Remove the error icon on the tab
            }

            var tabsHaveErrors = false;
            for (var tab in formTabErrors) {
                var numOfErrors = formTabErrors[tab];
                if (numOfErrors > 0) {
                    tabsHaveErrors = true;
                    break;
                }
            }

            if (tabsHaveErrors) {
                log("Hiding save button and showing form message box");
                jQuery(".saveButton").hide();                       // Hide save button(s)
                jQuery(".formControls").css("height", "30px");      // Adjust height for missing save button
                jQuery("#messageBoxContainer").hide();                 // Hide server messages
                jQuery("#clientMessageBoxContainer").show();           // Show client error messages
            } else {
                log("Showing save button and hiding form message box");
                jQuery(".saveButton").show();                       // Show save button(s)
                jQuery(".formControls").css("height", "");          // Readjust height for present save button
                jQuery("#clientMessageBoxContainer").hide();           // Hide client error messages
            }
        }

        function formTabClicked() {
            jQuery("#messageBoxContainer").hide();                 // Hide server messages
        }

        function log(message) {
            return; // Remove to enable logging
            if (!log.window_ || log.window_.closed) {
                var win = window.open("", null, "width=400,height=200," +
                                                "scrollbars=yes,resizable=yes,status=no," +
                                                "location=no,menubar=no,toolbar=no");
                if (!win) return;
                var doc = win.document;
                doc.write("<html><head><title>Debug Log</title></head><body style='font-family: monospace'></body></html>");
                doc.close();
                log.window_ = win;
            }
            var logLine = log.window_.document.createElement("div");
            logLine.appendChild(log.window_.document.createTextNode(message));
            log.window_.document.body.appendChild(logLine);
        }

        // ###################### Design #################################

        function highlightStars(item, range, end) {
            for (i = 1; i <= range; i++) {
                styleClass = ".item"+item+"-rate"+i;
                jQuery(styleClass).attr("src", "../themes/sfwkorg/img/star_grey.gif");
            }
            for (i = 1; i <= end; i++) {
                styleClass = ".item"+item+"-rate"+i;
                jQuery(styleClass).attr("src", "../themes/sfwkorg/img/star.gif");
            }
        }

        function pulsate(query) {
            var blinkCount = 2*2;
            do {
                jQuery(query)['fade'+(blinkCount%2==0?'Out':'In')]('fast');
            } while (--blinkCount);
        }

        function clearDocumentBackground() {
            // Noop for this skin
        }

        // Wrap boxes with border and shadow
        function wrapBoxes() {
            // Noop for this skin
        }

        function initPage() {
            checkCookieSupport();
            wrapBoxes();
        }

        jQuery(function() {
            initPage();
        });

    </script> 
  <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-25106513-1']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

    </script> 
 </head> 
 <body> 
  <noscript> 
   <div class="cookieJavaScriptWarning">
     Please activate JavaScript in your browser. Without it, you will only be able to browse this website but clicking on any advanced feature (any forms or submit buttons) will not work. 
   </div> 
  </noscript>
  <div id="dialogHelp" class="popupDialog">
   <span id="dialogHelpPopup" title="dialogHelp"></span>
   <span id="dialogHelpInit"> <script type="text/javascript">
            function showHelpPopup(width, height, offsetId) {
                var offset = jQuery("#"+offsetId).offset();
                jsf('dialogHelpPopup')
                    .css({width: width+"px", height: height+"px", top: offset.top-100+"px", left: offset.left-150+"px"})
                    .jqm({
                        closeClass: "closeDialog",
                        overlay: 0
                    });

                jQuery("#dialogHelpContent").css("width", width-20+"px").css("height", height-75+"px");
                jQuery("#dialogHelpContent").css("overflow", "auto");

                jsf('dialogHelpPopup').jqmShow();
            }
        </script></span> 
   <script type="text/javascript">jQuery(function() {
        jsf('dialogHelpPopup').Resizable({
            minTop: 1,
            dragHandle: "#dialogHelpHead",
            handlers: { se: "#dialogHelpResizeHandle" }
        });
    });</script> 
   <div class="popupDialogHead" id="dialogHelpHead">
    Help
   </div>
   <div id="dialogHelpContent" class="popupDialogContent"></div>
   <div id="dialogHelpControls" class="popupDialogControls">
    <div id="j_id14" style="padding:5px;">
     <a href="#" class="buttonNonpersistent closeDialog"><span class="buttonLabel">Close Help</span></a>
    </div>
   </div>
  </div> 
  <div id="wrapper"> 
   <div id="header">  
    <div>
     <a href="http://seamframework.org/"><img src="../themes/sfwkorg/img/blank.gif" height="98" width="210"></a> 
    </div> 
   </div>
   <div id="body"> 
    <div id="container"> 
     <div id="leftColumn">
      <div id="mainMenu" xmlns="http://www.w3.org/1999/xhtml">
       <div id="j_id121" class="box">
        <div class="mainMenuContainer"> 
         <div class="mainMenuHeader"></div> 
         <div class="mainMenuBody">
          <div id="j_id125" class="level1">
           <span class="level1Marker level1MarkerDot">·</span>
           <span class="level1Marker level1MarkerGreaterThan">&gt;</span>
           <span class="level1Marker level1MarkerSlash">/</span>
           <span class="level1Marker level1MarkerSpace">&nbsp;</span>
           <a href="../Home.html" class="level1Link">Home</a>
          </div>
          <div id="j_id132" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="../Home/WhySeam.html" class="level2Link">Why Seam?</a>
          </div>
          <div id="j_id139" class="level1">
           <span class="level1Marker level1MarkerDot">·</span>
           <span class="level1Marker level1MarkerGreaterThan">&gt;</span>
           <span class="level1Marker level1MarkerSlash">/</span>
           <span class="level1Marker level1MarkerSpace">&nbsp;</span>
           <a href="../Seam2.html" class="level1Link">Seam 2</a>
          </div>
          <div id="j_id146" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="../Seam2/GettingStarted.html" class="level2Link">Getting Started</a>
          </div>
          <div id="j_id153" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="../Seam2/Downloads.html" class="level2Link">Downloads</a>
          </div>
          <div id="j_id160" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="../Seam2/Documentation.html" class="level2Link">Documentation</a>
          </div>
          <div id="j_id167" class="level1">
           <span class="level1Marker level1MarkerDot">·</span>
           <span class="level1Marker level1MarkerGreaterThan">&gt;</span>
           <span class="level1Marker level1MarkerSlash">/</span>
           <span class="level1Marker level1MarkerSpace">&nbsp;</span>
           <a href="http://weld.cdi-spec.org/" class="level1Link">Weld</a>
          </div>
          <div id="j_id174" class="level1">
           <span class="level1Marker level1MarkerDot">·</span>
           <span class="level1Marker level1MarkerGreaterThan">&gt;</span>
           <span class="level1Marker level1MarkerSlash">/</span>
           <span class="level1Marker level1MarkerSpace">&nbsp;</span>
           <a href="../Community.html" class="level1Link">Community</a>
          </div>
          <div id="j_id181" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="https://community.jboss.org/" class="level2Link">Forums</a>
          </div>
          <div id="j_id188" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="../Community/CDIExtensions.html" class="level2Link">CDI Extensions</a>
          </div>
          <div id="j_id195" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="../Community/Contribute.html" class="level2Link">Contribute</a>
          </div>
          <div id="j_id202" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="../Community/JIRA.html" class="level2Link">JIRA</a>
          </div>
          <div id="j_id209" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="../Community/MailingLists.html" class="level2Link">Mailing Lists</a>
          </div>
          <div id="j_id216" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="../Community/Events.html" class="level2Link">Events</a>
          </div>
          <div id="j_id223" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="../Community/Links.html" class="level2Link">Links</a>
          </div>
          <div id="j_id230" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="../Community/SeamInProduction.html" class="level2Link">Seam In Production</a>
          </div>
          <div id="j_id237" class="level1">
           <span class="level1Marker level1MarkerDot">·</span>
           <span class="level1Marker level1MarkerGreaterThan">&gt;</span>
           <span class="level1Marker level1MarkerSlash">/</span>
           <span class="level1Marker level1MarkerSpace">&nbsp;</span>
           <a href="../Documentation.html" class="level1Link">Documentation</a>
          </div>
          <div id="j_id244" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="FAQs.html" class="level2Link">FAQs</a>
          </div>
          <div id="j_id251" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="KnowledgeBase.html" class="level2Link">Knowledge Base</a>
          </div>
          <div id="j_id258" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="Design.html" class="level2Link">Design</a>
          </div> 
         </div> 
         <div class="mainMenuFooter"></div> 
        </div>
       </div> 
      </div> 
      <br> 
      <div style="margin-top: 25px; margin-left: 15px; margin-right: 15px; "> 
       <h2>Built with Seam</h2> 
       <p> You can find the full source code for this website in the <a href="/Download.html">Seam package</a> in the directory /examples/wiki. It is licensed under the LGPL. </p> 
       <div style="text-align:center;">
        <a href="/Community/GetASeamIcon.html"><img src="../themes/sfwkorg/img/runningon_seamlogo_beige.gif" height="50" width="200"></a> 
       </div> 
      </div> 
     </div> 
     <div id="rightColumn">
      <img src="../themes/sfwkorg/img/blank.gif" height="8" width="1">
      <div id="breadcrumb" class="breadcrumb">
       <span class="breadcrumbPanel"><a href="../index.html" class="itemLink breadcrumbRoot">Site</a><span class="itemSeparator breadcrumbRoot">·</span><a href="../Documentation.html" class="itemLink">Documentation</a><span class="itemSeparatorDot itemSeparator">·</span><span class="itemSeparatorGreaterThan itemSeparator">&gt;</span><span class="itemSeparatorSlash itemSeparator">/</span><a href="KnowledgeBase.html" class="itemLink">Knowledge Base</a><span class="itemSeparatorDot itemSeparator">·</span><span class="itemSeparatorGreaterThan itemSeparator">&gt;</span><span class="itemSeparatorSlash itemSeparator">/</span><a href="JSF.html" class="itemLink">JSF</a><span class="itemSeparatorDot itemSeparator">·</span><span class="itemSeparatorGreaterThan itemSeparator">&gt;</span><span class="itemSeparatorSlash itemSeparator">/</span><a href="DropdownBoxesWithEntitiesAndPageScope.html" class="itemText">Drop-down boxes with entities and ...</a></span>
      </div>
      <div id="messageBoxContainer"></div>
      <div id="clientMessageBoxContainer" style="display:none;"> 
       <div id="clientMessageBox" class="messageBox"> 
        <table id="clientMessageBoxTable" class="messageBoxTable" cellpadding="0" cellspacing="0" border="0"></table> 
        <script type="text/javascript">jQuery(function() {
                    jQuery("#clientMessageBoxContainer").css("margin-top", "10px").css("margin-bottom", "10px");
                    pulsate(".clientMessageBoxImage");
                });</script> 
       </div>
      </div> 
      <div id="documentDisplayContainer" class="box">
       <div id="documentDisplay" class="documentDisplay">
        <div id="j_id362"> 
         <h1 class="documentTitle"><a href="DropdownBoxesWithEntitiesAndPageScope.html">Drop-down boxes with entities and page scope</a> </h1>
        </div>
        <p class="wikiPara"> Drop-down (or combo) boxes are problematic in JSF. First, consider how these form elements work in HTML: </p> 
        <p class="wikiPara"> A drop-down box in a form is using two kinds of values. The first value is the label of each item in the list, which is what your users see and what they click on. The second value is the internal value of the list item, which is what will be send to the server after the user clicks. All of these values are strings. </p> 
        <p class="wikiPara"> Therefore, it is quite straightforward to create a JSF combo-box that displays a <tt>List&lt;String&gt;</tt>, and that invokes a <tt>selectString(s)</tt> action when an item is selected. </p> 
        <p class="wikiPara"> What if you have a <tt>List&lt;Customer&gt;</tt> and you want the <tt>selectCustomer(c)</tt> method to be called? </p> 
        <p class="wikiPara"> As the HTML and form submit will only support string values, you have to convert <tt>Customer</tt> entity instances to and from strings. That is the job of the built-in Seam entity converter, available as <tt>&lt;s:convertEntity/&gt;</tt> in your form template. </p> 
        <h2 class="wikiHeadline2" id="H-TheJSFSpecificationRequirementAndTheBrokenImplementation"><a href="DropdownBoxesWithEntitiesAndPageScope.html#H-TheJSFSpecificationRequirementAndTheBrokenImplementation">The JSF specification requirement and the broken implementation</a></h2> 
        <p class="wikiPara"> But there is another catch, which is the JSF reference implementation. Let's first look at the JSF 1.0 specification (sections 4.1.15.3 and 4.1.16.3): </p> 
        <blockquote class="wikiBlockquote">
          ...must provide a specialized validate() method which ensures that any decoded value is a valid option (from the nested UISelectItem and UISelectItems children). 
        </blockquote> 
        <p class="wikiPara"> The goal of this is clear: When a string value is submitted by the user with the form, the JSF backend has to do some extra validation to ensure that the value is actually one of the possible values. In other words, if you present your user a list of strings in a drop-down box, you want to make sure that what is submitted is really one of those strings, not something else that might be potentially dangerous. If it is not valid, JSF will queue a message with the text <q>Value is not valid</q>, which is very very confusing for new JSF users. </p> 
        <p class="wikiPara"> The issue is the JSF reference implementation and how it implements this requirement. The mentioned <q>specialized <tt>validate()</tt> method</q> is in there and it does something which is OK for a list of strings: It takes the submitted value and compares it with every item in the list: <tt>submittedValue.equals(eachAndEveryListValue)</tt>. This is great for strings, because they are equal if they have the same characters. </p> 
        <p class="wikiPara"> How does the Seam entity converter handle this behavior, when it converts a <tt>Customer</tt> from and to a string? </p> 
        <p class="wikiPara"> When your drop down box is rendered, the <tt>List&lt;Customer&gt;</tt> is transformed into a list of strings, each string is the entity identifier value of the <tt>Customer</tt> instance. </p> 
        <p class="wikiPara"> When the drop down box is submitted, the submitted string value is converted back into a <tt>Customer</tt> instance by loading it from the database, using the identifier primary key. </p> 
        <p class="wikiPara"> Now the problem: The <tt>Customer</tt> instance that was just loaded from the database is compared with the <tt>List&lt;Customer&gt;</tt> elements using <tt>a.equals(b)</tt>. It has to match one of the list items, or it won't be a valid selection. </p> 
        <p class="wikiPara"> <i class="wikiEmphasis">THIS ONLY WORKS WHEN <tt>List&lt;CUSTOMER&gt;</tt> AND THE <tt>Customer</tt> INSTANCE ARE USING THE SAME PERSISTENCE CONTEXT! OR WHEN <tt>Customer</tt> OVERRIDES THE <tt>equals()</tt> METHOD ACCORDINGLY!</i> </p> 
        <p class="wikiPara"> When the form is submitted, the <tt>List&lt;Customer&gt;</tt> has to be the same or return the same instances (as in <tt>a == b</tt>, the default <tt>equals()</tt> in <tt>java.lang.Object</tt>) that have been used to render the list 5 minutes earlier. Typically, you'd use a Seam long-running conversation and a conversation-scoped component as the backing bean for your JSF form, so that the EntityManager and the persistence context are held across requests and you will get the same entity instances all the time. </p> 
        <p class="wikiPara"> This can be very inconvenient if you just want a drop-down box of <tt>List&lt;Customer&gt;</tt> and no long-running conversation. </p> 
        <h2 class="wikiHeadline2" id="H-AConvenientWorkaround"><a href="DropdownBoxesWithEntitiesAndPageScope.html#H-AConvenientWorkaround">A convenient workaround</a></h2> 
        <p class="wikiPara"> The following custom entity converter is a replacement for <tt>&lt;s:convertEntity/&gt;</tt> and it tries to work around the JSF reference implementation behavior. When a selection is submitted, it is converted back to an instance of <tt>Customer</tt> (or whatever entity you have), but that instance is then discarded and an <q>equal</q> instance of the original customer list is returned. Getting that original list is a bit tricky, but possible: </p> 
        <pre class="wikiPreformatted">
import org.jboss.seam.ScopeType;
import org.jboss.seam.annotations.Install;
import org.jboss.seam.annotations.Name;
import org.jboss.seam.annotations.Scope;
import org.jboss.seam.annotations.Transactional;
import org.jboss.seam.annotations.faces.Converter;
import org.jboss.seam.annotations.intercept.BypassInterceptors;
import org.jboss.seam.ui.AbstractEntityLoader;

import javax.faces.component.UIComponent;
import javax.faces.context.FacesContext;
import javax.faces.convert.ConverterException;
import java.beans.Introspector;
import java.beans.PropertyDescriptor;
import java.io.Serializable;
import java.util.Collection;
import java.util.Set;
import java.util.HashSet;

/**
 * Enhances the Seam entity converter and avoids "Value is not valid" validation errors by
 * not only decoding a requested entity identifier and loading that entity, but also returning
 * the matching (configurable) original instance from the select list. This solves the following
 * problem if you are not using a long-running CONVERSATION:
 * &lt;p/&gt;
 * &lt;a href="http://in.relation.to/2708.lace"&gt;Dropdowns in JSF: Validating the selected value&lt;/a&gt;
 *
 * @author Christian Bauer
 */
@Name("matchingEntityConverter")
@Scope(ScopeType.CONVERSATION)
@Install(precedence = Install.APPLICATION)
@Converter
@BypassInterceptors
public class MatchingEntityConverter implements javax.faces.convert.Converter, Serializable {

    private AbstractEntityLoader entityLoader;

    public AbstractEntityLoader getEntityLoader() {
        if (entityLoader == null) {
            return AbstractEntityLoader.instance();
        } else {
            return entityLoader;
        }
    }

    public void setEntityLoader(AbstractEntityLoader entityLoader) {
        this.entityLoader = entityLoader;
    }

    @SuppressWarnings("unchecked")
    @Transactional
    public String getAsString(FacesContext facesContext, UIComponent cmp, Object value) throws ConverterException {
        if (value == null) {
            return null;
        }
        if (value instanceof String) {
            return (String) value;
        }
        return getEntityLoader().put(value);
    }


    @Transactional
    public Object getAsObject(FacesContext facesContext, UIComponent cmp, String value) throws ConverterException {
        if (value == null) {
            return null;
        }
        Object loadedInstance = getEntityLoader().get(value);

        // THIS IS THE EXTENSION THAT MAKES THIS SPECIAL:

        // We will try to return the _original_value from the _original_ list, instead of the instance that
        // we just loaded from the database. This makes validation work, because equals() will be called on the
        // returned instance and it will be compared to all items in the list. If the instance we just loaded
        // is therefore not equal() to an item of the list, we'd get a "value is not valid" error. Returning one
        // of the instances from the list avoids that. We implement our own matching routine here, configurable.

        Object equalListInstance = null;
        try {

            Object loadedPropertyValue = null;
            if (loadedInstance != null) {
                loadedPropertyValue = readMatchingProperty(loadedInstance);
            }

            if (loadedPropertyValue != null) {

                Set originalList = getOriginalSelectItems(cmp);
                for (Object listInstance : originalList) {

                    Object listItemPropertyValue = readMatchingProperty(listInstance);
                    if (listItemPropertyValue != null &amp;&amp; loadedPropertyValue.equals(listItemPropertyValue)) {
                        equalListInstance = listInstance;
                        break;
                    }
                }
            }
        } catch (Exception ex) {
            throw new ConverterException(ex);
        }

        // Fall back to loadedInstance.equals(&lt;for each listInstance&gt;) which is what the JSF RI implementors
        // do in their JPA-unfriendly validation routine that will run after this...
        return equalListInstance != null ? equalListInstance : loadedInstance;
    }

    protected Object readMatchingProperty(Object o) throws Exception {
        PropertyDescriptor[] props = Introspector.getBeanInfo(o.getClass()).getPropertyDescriptors();
        for (PropertyDescriptor descriptor : props) {
            if (descriptor.getName().equals(getMatch())) {
                return descriptor.getReadMethod().invoke(o);
            }
        }
        return null;
    }

    protected Set getOriginalSelectItems(UIComponent cmp) {
        Set items = new HashSet();
        // This is really ugly, but what can you do...
        for (UIComponent child : cmp.getChildren()) {
            if (child instanceof javax.faces.component.UISelectItems) {
                javax.faces.component.UISelectItems selectItems = (javax.faces.component.UISelectItems) child;
                for (Object selectItemsValue : (Collection) selectItems.getValue()) {
                    javax.faces.model.SelectItem selectItem = (javax.faces.model.SelectItem) selectItemsValue;
                    if (selectItem.getValue() == null) continue;
                    items.add(selectItem.getValue());
                }
                break;
            }
        }
        return items;
    }

    private String match;

    public String getMatch() {
        if (match == null) {
            return "id"; // Most entities would have that property
        }
        return match;
    }

    public void setMatch(String match) {
        this.match = match;
    }
}
</pre> 
        <p class="wikiPara"> How <tt>Customer</tt>, <tt>Product</tt>, or whatever instances are compared and considered <q>equal</q> is configurable, by default a property called <tt>id</tt> is expected, but you can override this in your components.xml: </p> 
        <pre class="wikiPreformatted">&lt;component name="identifierMatchingEntityConverter"
           class="common.web.MatchingEntityConverter"&gt;
    &lt;property name="match"&gt;id&lt;/property&gt; &lt;!-- That's actually the default property we'd use for comparison--&gt;
&lt;/component&gt;
</pre> 
        <p class="wikiPara"> Use it like this in your templates - note the AJAX automatic submit, this is why you'd want the PAGE scope instead of a long-running conversation: </p> 
        <pre class="wikiPreformatted">&lt;h:selectOneMenu value="#{browseProducts.selectedProduct}"
                 converter="#{identifierMatchingEntityConverter}"&gt; &lt;!-- The magic that makes it work! --&gt;
    &lt;s:selectItems value="#{browseProducts.list}"
                   var="p"
                   label="#{p.name}"
                   noSelectionLabel="NO PRODUCT SELECTED"&gt;
    &lt;/s:selectItems&gt;
    &lt;a:support event="onchange" action="#{browseProducts.productSelected}/&gt;
&lt;/h:selectOneMenu&gt;
</pre> 
        <p class="wikiPara"> The browseProduct backing bean is in PAGE scope. This new converter makes it work without a long-running conversation scope and with two different persistence contexts before and after the submit: </p> 
        <pre class="wikiPreformatted">@Name("browseProducts")
@Scope(ScopeType.PAGE)
public class BrowseProducts {

    public List&lt;Product&gt; getList() {
        ... // Load the Products from the database
    }

    private Product selectedProduct;

    public Product getSelectedProduct() {
        return selectedProduct;
    }

    public void setSelectedProduct(Product selectedProduct) {
        this.selectedProduct = selectedProduct;
    }

    public void productSelected() { ... // Do stuff }
}
</pre> 
       </div>
       <div id="j_id374" class="documentCreatorHistory undecoratedLink smallFont">
        <div id="j_id375">
          Created:&nbsp;08. Sep 2009, 04:35&nbsp;America/New_York&nbsp;(Christian Bauer)
        </div>
        <div id="j_id383">
          Last Modified:&nbsp;15. Sep 2009, 23:23&nbsp;America/New_York&nbsp;(Christian Bauer)
        </div>
       </div> 
      </div>
      <div id="commentDisplayForm">
       <div id="comments" class="commentsDisplay"></div>
      </div> 
     </div> 
     <div class="clear" style="padding-top:15px;"></div> 
    </div>
   </div> 
  </div> 
  <div id="footer" class="undecoratedLink"> 
   <p> © Copyright 2009, Red Hat Middleware, LLC. All rights reserved. JBoss and Seam are registered trademarks and servicemarks of <a href="http://www.redhat.com/">Red Hat, Inc</a>. [<a href="http://www.redhat.com/legal/privacy_statement.html">Privacy Policy</a>]</p> 
  </div>
  <div id="status">
   <span id="globalStatus"><span id="globalStatus.start" style="display: none">
     <div id="j_id608" class="statusStart">
      <img src="../themes/sfwkorg/img/statusindicator.gif" height="25" width="20">
     </div></span><span id="globalStatus.stop">
     <div id="j_id610" class="statusStop">
      <img src="../themes/sfwkorg/img/blank.gif" height="25" width="20">
     </div></span></span>
  </div>  
  <!-- Mirrored from 127.0.0.1:64444/Documentation/DropdownBoxesWithEntitiesAndPageScope by HTTrack Website Copier/3.x [XR&CO'2008], Wed, 01 Oct 2014 13:47:19 GMT --> 
  <!-- Added by HTTrack -->
  <meta http-equiv="content-type" content="text/html;charset=UTF-8">
  <!-- /Added by HTTrack --> 
 </body>
</html>