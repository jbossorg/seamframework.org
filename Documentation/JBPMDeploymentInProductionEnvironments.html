<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <!-- Mirrored from 127.0.0.1:64444/Documentation/JBPMDeploymentInProductionEnvironments by HTTrack Website Copier/3.x [XR&CO'2008], Wed, 01 Oct 2014 13:47:27 GMT -->
 <!-- Added by HTTrack -->
 <head>
  <meta http-equiv="content-type" content="text/html;charset=UTF-8">
  <!-- /Added by HTTrack -->  
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
  <title>Seam Framework - jBPM deployment in production environments</title> 
  <link class="component" href="../a4j/s/3_3_3.CR1org/richfaces/renderkit/html/css/basic_classes.xcss/DATB/eAELXT5DOhSIAQ%21sA18_.css" rel="stylesheet" type="text/css">
  <link class="component" href="../a4j/s/3_3_3.CR1org/richfaces/renderkit/html/css/extended_classes.xcss/DATB/eAELXT5DOhSIAQ%21sA18_.css" media="rich-extended-skinning" rel="stylesheet" type="text/css">
  <script src="../a4j/g/3_3_3.CR1org.ajax4jsf.javascript.AjaxScript" type="text/javascript"></script>
  <script type="text/javascript">window.RICH_FACES_EXTENDED_SKINNING_ON=true;</script>
  <script src="../a4j/g/3_3_3.CR1org/richfaces/renderkit/html/scripts/skinning.js" type="text/javascript"></script>
  <link href="../themes/sfwkorg/css/sfwk.css" rel="stylesheet" type="text/css"> 
  <link href="../themes/sfwkorg/css/shCore.css" rel="stylesheet" type="text/css"> 
  <link href="../themes/sfwkorg/css/shThemeDefault.css" rel="stylesheet" type="text/css"> 
  <script type="text/javascript" src="../seam/resource/remoting/resource/remote.js"></script> 
  <script type="text/javascript" src="../seam/resource/remoting/interface1535.js?httpSessionChecker"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/jquery.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/jqueryPlugins.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/lacewiki.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shCore.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushBash.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushCpp.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushCSharp.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushCss.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushDelphi.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushDiff.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushGroovy.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushJava.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushJScript.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushPhp.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushPlain.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushPython.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushRuby.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushScala.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushSql.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushVb.js"></script> 
  <script type="text/javascript" src="../themes/sfwkorg/js/sh/scripts/shBrushXml.js"></script> 
  <script type="text/javascript">
        /* If you really want to load the Flash garbage on every page, go ahead and enable this:
        SyntaxHighlighter.config.clipboardSwf = '/themes/sfwkorg/js/sh/scripts/clipboard.swf';
         */
        SyntaxHighlighter.defaults['gutter'] = false;
        SyntaxHighlighter.all();
	</script> 
  <script type="text/javascript">

        // ###################### Session timeout alert #################################

        var sessionChecker = Seam.Component.getInstance("httpSessionChecker");
        var timeoutURL = '/Home/JBossSeam';
        var timeoutMillis = '900'*1000+3000;
        var sessionTimeoutInterval = null;

        function startSessionTimeoutCheck() {
            sessionTimeoutInterval = setInterval('sessionChecker.isNewSession(alertTimeout)', timeoutMillis);
        }

        function stopSessionTimeoutCheck() {
            if (sessionTimeoutInterval) clearInterval(sessionTimeoutInterval);
        }

        function resetSessionTimeoutCheck() {
            if (sessionTimeoutInterval != null) {
                stopSessionTimeoutCheck();
                startSessionTimeoutCheck();
            }
        }

        function alertTimeout(newSession) {
            if (newSession) {
                clearInterval(sessionTimeoutInterval);
                jQuery(".ajaxSupport")
                        .removeAttr('onblur')
                        .removeAttr('onchange')
                        .removeAttr('onkeyup')
                        .removeAttr('onclick');
                jQuery(".sessionEventTrigger").hide();
                var answer = confirm("Your session has timed out, you will be redirected to the start page.");
                if (answer) window.location = timeoutURL;
            }
        }

        // ###################### Popups #################################

        var fadeInPopupDialog = function(hash) {
            hash.w.fadeIn('fast',function(){ hash.o.show(); });
            jQuery(".closeDialog", hash.w).attr("accesskey", "C"); // Dynamically assign accesskey to .closeDialog buttons
        };

        var fadeOutPopupDialog = function(hash) { hash.w.fadeOut('fast',function(){ hash.o.remove(); }); };

        // ###################### Tabbed Forms #################################

        var formTabErrors = {};

        function formTabRaiseError(tabId, fieldId, message) {

            formTabClearError(tabId, fieldId); // Clear error then re-add

            log("Raise error for tab: '" + tabId + "' field: " + fieldId);

            // Add an error message to the client message box
            log("Adding error message: " +tabId + fieldId + "ErrorMessage")
            jQuery("#clientMessageBoxTable").append(
                '<tr id="' + tabId + fieldId + 'ErrorMessage"><td><img src="/themes/sfwkorg/img/attention.gif" ' +
                'height="18" width="18" class="clientMessageBoxImage attentionImage"/></td>' +
                '<td><span id="attentionMessage" class="attentionMessage">'+ message + '</span></td></tr>'
            );
            if (formTabErrors[tabId] == null) {
                formTabErrors[tabId] = 1;
            } else {
                formTabErrors[tabId]++;
            }
            formTabRenderErrors(tabId);
        }

        function formTabClearError(tabId, fieldId) {
            if (document.getElementById(tabId+fieldId+"ErrorMessage") != null) { // This error is displayed
                log("Clear error for tab: '" + tabId + "' field: " + fieldId);
                log("Removing error message: " +tabId + fieldId + "ErrorMessage")
                // Remove the error message on the client message box
                jQuery("#"+tabId + fieldId + "ErrorMessage").remove();

                formTabErrors[tabId]--;
                formTabRenderErrors(tabId);
            }
        }

        function formTabRenderErrors(tabId) {
            log("Errors for tab: '" + tabId + "': " + formTabErrors[tabId]);

            if (formTabErrors[tabId] > 0 && document.getElementById(tabId+"InvalidIcon") == null) {
                log("Showing icon for tab: " + tabId);
                // Show an icon on the tab and blink it a few times
                jQuery("#"+tabId)
                    .prepend('<img id="' + tabId + 'InvalidIcon" ' +
                            'src="/themes/sfwkorg/img/attention.gif" width="13" height="13" ' +
                            'alt="!" style="vertical-align:bottom;margin-left:5px;margin-right:5px;"/>');
                pulsate("#"+tabId);
            } else if (formTabErrors[tabId] < 1){
                log("Removing icon of tab: " + tabId);
                jQuery("#"+tabId + "InvalidIcon").remove();             // Remove the error icon on the tab
            }

            var tabsHaveErrors = false;
            for (var tab in formTabErrors) {
                var numOfErrors = formTabErrors[tab];
                if (numOfErrors > 0) {
                    tabsHaveErrors = true;
                    break;
                }
            }

            if (tabsHaveErrors) {
                log("Hiding save button and showing form message box");
                jQuery(".saveButton").hide();                       // Hide save button(s)
                jQuery(".formControls").css("height", "30px");      // Adjust height for missing save button
                jQuery("#messageBoxContainer").hide();                 // Hide server messages
                jQuery("#clientMessageBoxContainer").show();           // Show client error messages
            } else {
                log("Showing save button and hiding form message box");
                jQuery(".saveButton").show();                       // Show save button(s)
                jQuery(".formControls").css("height", "");          // Readjust height for present save button
                jQuery("#clientMessageBoxContainer").hide();           // Hide client error messages
            }
        }

        function formTabClicked() {
            jQuery("#messageBoxContainer").hide();                 // Hide server messages
        }

        function log(message) {
            return; // Remove to enable logging
            if (!log.window_ || log.window_.closed) {
                var win = window.open("", null, "width=400,height=200," +
                                                "scrollbars=yes,resizable=yes,status=no," +
                                                "location=no,menubar=no,toolbar=no");
                if (!win) return;
                var doc = win.document;
                doc.write("<html><head><title>Debug Log</title></head><body style='font-family: monospace'></body></html>");
                doc.close();
                log.window_ = win;
            }
            var logLine = log.window_.document.createElement("div");
            logLine.appendChild(log.window_.document.createTextNode(message));
            log.window_.document.body.appendChild(logLine);
        }

        // ###################### Design #################################

        function highlightStars(item, range, end) {
            for (i = 1; i <= range; i++) {
                styleClass = ".item"+item+"-rate"+i;
                jQuery(styleClass).attr("src", "../themes/sfwkorg/img/star_grey.gif");
            }
            for (i = 1; i <= end; i++) {
                styleClass = ".item"+item+"-rate"+i;
                jQuery(styleClass).attr("src", "../themes/sfwkorg/img/star.gif");
            }
        }

        function pulsate(query) {
            var blinkCount = 2*2;
            do {
                jQuery(query)['fade'+(blinkCount%2==0?'Out':'In')]('fast');
            } while (--blinkCount);
        }

        function clearDocumentBackground() {
            // Noop for this skin
        }

        // Wrap boxes with border and shadow
        function wrapBoxes() {
            // Noop for this skin
        }

        function initPage() {
            checkCookieSupport();
            wrapBoxes();
        }

        jQuery(function() {
            initPage();
        });

    </script> 
  <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-25106513-1']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

    </script> 
 </head> 
 <body> 
  <noscript> 
   <div class="cookieJavaScriptWarning">
     Please activate JavaScript in your browser. Without it, you will only be able to browse this website but clicking on any advanced feature (any forms or submit buttons) will not work. 
   </div> 
  </noscript>
  <div id="dialogHelp" class="popupDialog">
   <span id="dialogHelpPopup" title="dialogHelp"></span>
   <span id="dialogHelpInit"> <script type="text/javascript">
            function showHelpPopup(width, height, offsetId) {
                var offset = jQuery("#"+offsetId).offset();
                jsf('dialogHelpPopup')
                    .css({width: width+"px", height: height+"px", top: offset.top-100+"px", left: offset.left-150+"px"})
                    .jqm({
                        closeClass: "closeDialog",
                        overlay: 0
                    });

                jQuery("#dialogHelpContent").css("width", width-20+"px").css("height", height-75+"px");
                jQuery("#dialogHelpContent").css("overflow", "auto");

                jsf('dialogHelpPopup').jqmShow();
            }
        </script></span> 
   <script type="text/javascript">jQuery(function() {
        jsf('dialogHelpPopup').Resizable({
            minTop: 1,
            dragHandle: "#dialogHelpHead",
            handlers: { se: "#dialogHelpResizeHandle" }
        });
    });</script> 
   <div class="popupDialogHead" id="dialogHelpHead">
    Help
   </div>
   <div id="dialogHelpContent" class="popupDialogContent"></div>
   <div id="dialogHelpControls" class="popupDialogControls">
    <div id="j_id14" style="padding:5px;">
     <a href="#" class="buttonNonpersistent closeDialog"><span class="buttonLabel">Close Help</span></a>
    </div>
   </div>
  </div> 
  <div id="wrapper"> 
   <div id="header">  
    <div>
     <a href="http://seamframework.org/"><img src="../themes/sfwkorg/img/blank.gif" height="98" width="210"></a> 
    </div> 
   </div>
   <div id="body"> 
    <div id="container"> 
     <div id="leftColumn">
      <div id="mainMenu" xmlns="http://www.w3.org/1999/xhtml">
       <div id="j_id121" class="box">
        <div class="mainMenuContainer"> 
         <div class="mainMenuHeader"></div> 
         <div class="mainMenuBody">
          <div id="j_id125" class="level1">
           <span class="level1Marker level1MarkerDot">·</span>
           <span class="level1Marker level1MarkerGreaterThan">&gt;</span>
           <span class="level1Marker level1MarkerSlash">/</span>
           <span class="level1Marker level1MarkerSpace">&nbsp;</span>
           <a href="../Home.html" class="level1Link">Home</a>
          </div>
          <div id="j_id132" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="../Home/WhySeam.html" class="level2Link">Why Seam?</a>
          </div>
          <div id="j_id139" class="level1">
           <span class="level1Marker level1MarkerDot">·</span>
           <span class="level1Marker level1MarkerGreaterThan">&gt;</span>
           <span class="level1Marker level1MarkerSlash">/</span>
           <span class="level1Marker level1MarkerSpace">&nbsp;</span>
           <a href="../Seam2.html" class="level1Link">Seam 2</a>
          </div>
          <div id="j_id146" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="../Seam2/GettingStarted.html" class="level2Link">Getting Started</a>
          </div>
          <div id="j_id153" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="../Seam2/Downloads.html" class="level2Link">Downloads</a>
          </div>
          <div id="j_id160" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="../Seam2/Documentation.html" class="level2Link">Documentation</a>
          </div>
          <div id="j_id167" class="level1">
           <span class="level1Marker level1MarkerDot">·</span>
           <span class="level1Marker level1MarkerGreaterThan">&gt;</span>
           <span class="level1Marker level1MarkerSlash">/</span>
           <span class="level1Marker level1MarkerSpace">&nbsp;</span>
           <a href="http://weld.cdi-spec.org/" class="level1Link">Weld</a>
          </div>
          <div id="j_id174" class="level1">
           <span class="level1Marker level1MarkerDot">·</span>
           <span class="level1Marker level1MarkerGreaterThan">&gt;</span>
           <span class="level1Marker level1MarkerSlash">/</span>
           <span class="level1Marker level1MarkerSpace">&nbsp;</span>
           <a href="../Community.html" class="level1Link">Community</a>
          </div>
          <div id="j_id181" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="https://community.jboss.org/" class="level2Link">Forums</a>
          </div>
          <div id="j_id188" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="../Community/CDIExtensions.html" class="level2Link">CDI Extensions</a>
          </div>
          <div id="j_id195" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="../Community/Contribute.html" class="level2Link">Contribute</a>
          </div>
          <div id="j_id202" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="../Community/JIRA.html" class="level2Link">JIRA</a>
          </div>
          <div id="j_id209" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="../Community/MailingLists.html" class="level2Link">Mailing Lists</a>
          </div>
          <div id="j_id216" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="../Community/Events.html" class="level2Link">Events</a>
          </div>
          <div id="j_id223" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="../Community/Links.html" class="level2Link">Links</a>
          </div>
          <div id="j_id230" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="../Community/SeamInProduction.html" class="level2Link">Seam In Production</a>
          </div>
          <div id="j_id237" class="level1">
           <span class="level1Marker level1MarkerDot">·</span>
           <span class="level1Marker level1MarkerGreaterThan">&gt;</span>
           <span class="level1Marker level1MarkerSlash">/</span>
           <span class="level1Marker level1MarkerSpace">&nbsp;</span>
           <a href="../Documentation.html" class="level1Link">Documentation</a>
          </div>
          <div id="j_id244" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="FAQs.html" class="level2Link">FAQs</a>
          </div>
          <div id="j_id251" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="KnowledgeBase.html" class="level2Link">Knowledge Base</a>
          </div>
          <div id="j_id258" class="level2">
           <span class="level2Marker level2MarkerDot">·</span>
           <span class="level2Marker level2MarkerGreaterThan">&gt;</span>
           <span class="level2Marker level2MarkerSlash">/</span>
           <span class="level2Marker level2MarkerSpace">&nbsp;</span>
           <a href="Design.html" class="level2Link">Design</a>
          </div> 
         </div> 
         <div class="mainMenuFooter"></div> 
        </div>
       </div> 
      </div> 
      <br> 
      <div style="margin-top: 25px; margin-left: 15px; margin-right: 15px; "> 
       <h2>Built with Seam</h2> 
       <p> You can find the full source code for this website in the <a href="/Download.html">Seam package</a> in the directory /examples/wiki. It is licensed under the LGPL. </p> 
       <div style="text-align:center;">
        <a href="/Community/GetASeamIcon.html"><img src="../themes/sfwkorg/img/runningon_seamlogo_beige.gif" height="50" width="200"></a> 
       </div> 
      </div> 
     </div> 
     <div id="rightColumn">
      <img src="../themes/sfwkorg/img/blank.gif" height="8" width="1">
      <div id="breadcrumb" class="breadcrumb">
       <span class="breadcrumbPanel"><a href="../index.html" class="itemLink breadcrumbRoot">Site</a><span class="itemSeparator breadcrumbRoot">·</span><a href="../Documentation.html" class="itemLink">Documentation</a><span class="itemSeparatorDot itemSeparator">·</span><span class="itemSeparatorGreaterThan itemSeparator">&gt;</span><span class="itemSeparatorSlash itemSeparator">/</span><a href="KnowledgeBase.html" class="itemLink">Knowledge Base</a><span class="itemSeparatorDot itemSeparator">·</span><span class="itemSeparatorGreaterThan itemSeparator">&gt;</span><span class="itemSeparatorSlash itemSeparator">/</span><a href="Integration.html" class="itemLink">Integration</a><span class="itemSeparatorDot itemSeparator">·</span><span class="itemSeparatorGreaterThan itemSeparator">&gt;</span><span class="itemSeparatorSlash itemSeparator">/</span><a href="JBPMDeploymentInProductionEnvironments.html" class="itemText">jBPM deployment in production envi...</a></span>
      </div>
      <div id="messageBoxContainer"></div>
      <div id="clientMessageBoxContainer" style="display:none;"> 
       <div id="clientMessageBox" class="messageBox"> 
        <table id="clientMessageBoxTable" class="messageBoxTable" cellpadding="0" cellspacing="0" border="0"></table> 
        <script type="text/javascript">jQuery(function() {
                    jQuery("#clientMessageBoxContainer").css("margin-top", "10px").css("margin-bottom", "10px");
                    pulsate(".clientMessageBoxImage");
                });</script> 
       </div>
      </div> 
      <div id="documentDisplayContainer" class="box">
       <div id="documentDisplay" class="documentDisplay">
        <div id="j_id362"> 
         <h1 class="documentTitle"><a href="JBPMDeploymentInProductionEnvironments.html">jBPM deployment in production environments</a> </h1>
        </div>
        <p class="wikiPara"> The default Seam jBPM deployment system is intended for development only. The reason being: each time the seam environment is started a fresh copy of the process definitions is deployed. This can cause much confusion in a production environment where the definitions should largely be static. Consequently, I found a need to have process definitions deployed only when they change. </p> 
        <p class="wikiPara"> I would like to use CVS to determine the version of my process definition. If the CVS version changes - I want it redeployed. Consequently, I have written some code extending the standard Seam Jbpm component to redeploy the process if the CVS version changes. </p> 
        <p class="wikiPara"> As a side note: it also allows the jbpm scheduler to be started too. </p> 
        <p class="wikiPara"> I hope that you'll find this useful. </p> 
        <h3 class="wikiHeadline3" id="H-Requirements"><a href="JBPMDeploymentInProductionEnvironments.html#H-Requirements">Requirements</a></h3> 
        <ul class="wikiUnorderedList"> 
         <li class="wikiUnorderedListItem"> Seam 2.0.1.GA</li> 
         <li class="wikiUnorderedListItem"> jBPM 3.2.2</li> 
         <li class="wikiUnorderedListItem"> optionally CVS for source control</li> 
         <li class="wikiUnorderedListItem"> If using <tt>&lt;process-state&gt;</tt> tags in your processes, its probably best to add the <tt>binding="late"</tt> attribute <a href="http://docs.jboss.com/jbpm/v3.2/userguide/html/jpdl.html#processstate.element" target="" class="regularLink">see jbpm docs</a>.</li> 
        </ul> 
        <h3 class="wikiHeadline3" id="H-Installation"><a href="JBPMDeploymentInProductionEnvironments.html#H-Installation">Installation</a></h3> 
        <ol class="wikiOrderedList"> 
         <li class="wikiOrderedListItem"> Clear out any existing definitions in the database (if this is not possible make sure that the db version is synched with the cvs version).</li> 
         <li class="wikiOrderedListItem"> Update the start of each process definition xml file to include the following, and then check it in to CVS: <pre class="wikiPreformatted">&lt;?JbpmExtensions $Revision$?&gt;</pre> For example: <pre class="wikiPreformatted">&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;?JbpmExtensions $Revision: 1.1 $?&gt;

&lt;process-definition xmlns="urn:jbpm.org:jpdl-3.2"
                    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                    xsi:schemaLocation="urn:jbpm.org:jpdl-3.2 http://jbpm.org/xsd/jpdl-3.2.xsd"  
                    name="myJbpmProcess"&gt;
  ...
&lt;/process-definition&gt;</pre> <i class="wikiEmphasis">If you don't use CVS:</i> you'll need to include the version manually (or using your source control's particular scheme of keyword replacement) in each file e.g. <tt>&lt;?JbpmExtensions version="1"?&gt;</tt> and set the versionPattern attribute on the component e.g. <tt>&lt;property name="versionPattern"&gt;version="([0-9]+)"&lt;/property&gt;</tt></li> 
         <li class="wikiOrderedListItem"> Update the components.xml to override the standard jbpm component, remove the following: <pre class="wikiPreformatted">&lt;bpm:jbpm&gt;...&lt;/bpm:jbpm&gt; </pre> and replace with <pre class="wikiPreformatted">  &lt;component name="org.jboss.seam.bpm.jbpm" class="uk.co.iblocks.jbpm.JbpmExtensions"&gt;
    &lt;property name="debugEnabled"&gt;false&lt;/property&gt; &lt;!-- optional, defaults to true : set to false deploy only if version has changed --&gt;
    &lt;property name="schedulerEnabled"&gt;true&lt;/property&gt;&lt;!-- optional, defaults to false: set to true to enable jbpm timers --&gt;
    &lt;property name="versionPattern"&gt;\$Revision: [0-9]+\.([0-9]+) \$&lt;/property&gt;&lt;!-- optional, defaults to cvs pattern: Must contain exactly one capture group --&gt;
    &lt;property name="processDefinitions"&gt;
      &lt;value&gt;WEB-INF/jbpm/myJbpmProcess/processdefinition.xml&lt;/value&gt;
      ...
    &lt;/property&gt;
  &lt;/component&gt;</pre> </li> 
         <li class="wikiOrderedListItem"> Include the following code in your Seam project (or download it: <a href="http://www.iblocks.co.uk/technical/articles.html" target="" class="regularLink">JbpmExtensions.java</a>): <pre class="wikiPreformatted">package uk.co.iblocks.jbpm;

import java.io.IOException;
import java.io.InputStream;
import java.net.URL;
import java.util.HashMap;
import java.util.Map;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import javax.xml.parsers.SAXParser;
import javax.xml.parsers.SAXParserFactory;

import org.jboss.seam.annotations.Startup;
import org.jboss.seam.annotations.intercept.BypassInterceptors;
import org.jboss.seam.bpm.Jbpm;
import org.jboss.seam.core.Init;
import org.jboss.seam.log.Log;
import org.jboss.seam.log.Logging;
import org.jboss.seam.util.Resources;
import org.jbpm.JbpmContext;
import org.jbpm.graph.def.ProcessDefinition;
import org.jbpm.job.executor.JobExecutor;
import org.xml.sax.InputSource;
import org.xml.sax.SAXException;
import org.xml.sax.helpers.DefaultHandler;

/**
 * &lt;b&gt;JbpmExtensions.java&lt;/b&gt;&lt;br&gt;
 *
 * An extension of the jbpm component to allow conditional deployment of the busines processes.
 * Only processes that have been modified since last deployment will be installed.
 * 
 * Each process definition must contain a xml processing instruction that defines the current version.
 * By default this is, for example:
 * &lt;?JbpmExtensions $Revision: 1.3 $?&gt;
 * 
 * The component must be setup in components.xml as follows:
 *   &lt;component name="org.jboss.seam.bpm.jbpm" class="uk.co.iblocks.jbpm.JbpmExtensions"&gt; 
 *     &lt;property name="processDefinitions"&gt;
 *       &lt;value&gt;processDefinion.xml&lt;/value&gt;
 *     &lt;/property&gt;
 *   &lt;/component&gt;
 *
 * @author &lt;a href="mailto:peter.brewer@iblocks.co.uk"&gt;Peter Brewer&lt;/a&gt;
 */
@BypassInterceptors
@Startup
public class JbpmExtensions extends Jbpm {

  private final class ProcessDescriptor {
    private Integer fileVersion ;
    private ProcessDefinition fileProcess ;
    private ProcessDefinition dbProcess ;
    
    public ProcessDescriptor(JbpmContext jbpmContext, String definitionResource) throws SAXException, IOException {
      setFileVersion( versionHandler.parse(definitionResource) ) ;
      setFileProcess( ProcessDefinition.parseXmlResource(definitionResource) ) ;
      setDbProcess( jbpmContext.getGraphSession().findLatestProcessDefinition(getFileProcess().getName())) ;
    }

    public Integer getFileVersion() {
      return fileVersion;
    }

    public void setFileVersion(Integer fileVersion) {
      this.fileVersion = fileVersion;
    }

    public ProcessDefinition getFileProcess() {
      return fileProcess;
    }

    public void setFileProcess(ProcessDefinition fileProcess) {
      this.fileProcess = fileProcess;
    }

    public ProcessDefinition getDbProcess() {
      return dbProcess;
    }

    public void setDbProcess(ProcessDefinition dbProcess) {
      this.dbProcess = dbProcess;
    }

    public boolean isNewProcess() {
      return getDbProcess() == null || (getFileVersion() != null &amp;&amp; getFileVersion() &gt; getDbProcess().getVersion()) ;
    }
    public boolean deploy(JbpmContext jbpmContext) {
      return deploy(jbpmContext, false) ;
    }
    public boolean deploy(JbpmContext jbpmContext, boolean forceDeployment) {
      if (forceDeployment || isNewProcess()) {
        log.info("Deploying process #0 - replacing db version #1 with file version #2", getFileProcess().getName(), getDbProcess() != null ? String.valueOf(getDbProcess().getVersion()) : "&lt;undeployed&gt;", getFileVersion()) ;
        jbpmContext.deployProcessDefinition(getFileProcess());
        ProcessDefinition newProcessDefinition = jbpmContext.getGraphSession().findLatestProcessDefinition(getFileProcess().getName()) ;

        // Note this overrides the jbpm automated versioning system to keep the file version and db version the same.
        if (getFileVersion() != null) {
          newProcessDefinition.setVersion( getFileVersion() != null ? getFileVersion() : getDbProcess().getVersion()) ;
        }

        if (forceDeployment &amp;&amp; !isNewProcess()) {
          // set the old version to negative - only the current version should be positive
          getDbProcess().setVersion(getDbProcess().getVersion() * -1) ;
        }
        return true ;
      } else {
        return false ;
      }
    }
    
  }
  
  private static final class VersionHandler extends DefaultHandler {
    
    private int version = -1 ;
    
    private boolean versionPIProcessed = false ; 
    
    private Pattern versionPattern = null ;
    
    private SAXParser parser = null ;
    
    public VersionHandler(String versionPattern) {
      this.versionPattern = Pattern.compile(versionPattern) ;
      SAXParserFactory sf = SAXParserFactory.newInstance() ;
      sf.setValidating(false);
      sf.setNamespaceAware(false);
      try {
        parser = sf.newSAXParser() ;
      } catch (Exception ex) {
        log.fatal("Cannot create xml parser.", ex) ;
        throw new IllegalStateException("Cannot create xml parser.") ;
      }
    }
    
    public Integer parse(String definitionResource) throws SAXException, IOException {
      reset() ;
      InputStream xmlStream = null ;
      try {
        URL processUrl = Resources.getResource(definitionResource, null) ;
        xmlStream = processUrl.openConnection().getInputStream() ;
        
        parser.parse(new InputSource(xmlStream), this);
        return getVersion() ;
      } finally {
        if (xmlStream != null) {
          try {
            xmlStream.close() ;
          } catch (IOException e) {
            log.debug("Cannot close xml stream for #0", e, definitionResource) ;
          }
        }        
      }
      
    }
    
    public void processingInstruction(String target, String data) throws SAXException {
      if (PI_TARGET.equals(target)) {
        Matcher m = versionPattern.matcher(data) ;
        if (m.matches() &amp;&amp; m.groupCount() == 1) {
          this.version = Integer.valueOf( m.group(1) );
        } else {
          log.warn("Found processing instruction but data does not match the pattern (or the pattern doesn't have exactly one capture group). Expected patten: #0", versionPattern.toString()) ;
        }
        versionPIProcessed = true ;
      }
    }
    
    public boolean isVersionPresent() {
      return versionPIProcessed ;
    }
    
    /** Currently returns the minor version number (in our cvs we just use 1.x, so its fine)
     * However, if we switched to incrementing the major number, then we'd have trouble.
     */
    public Integer getVersion() {
      if (isVersionPresent()) {
        return this.version ;
      } else {
        return null ;
      }
    }
    
    public void reset() {
      this.version = -1 ;
      this.versionPIProcessed = false ;
    }
    
  }
  
  private static final Log log = Logging.getLog(JbpmExtensions.class);
  private static final String PI_TARGET = "JbpmExtensions" ;
  private boolean debugEnabled = true ; 
  private boolean schedulerEnabled = false ;
  private String versionPattern = "\\$Revision: [0-9]+\\" + 
                                  ".([0-9]+) \\$" ;
  
  private VersionHandler versionHandler ;
  
  private boolean workflowDependenciesEnabled = false ;
  
  private Map&lt;String, ProcessDescriptor&gt; processDescriptors ;
  
  /**
   * Returns the regular expression pattern used for determining the version specified in the
   * xml processing instruction.
   * @return
   */
  public String getVersionPattern() {
    return versionPattern;
  }  
  public void setVersionPattern(String versionPattern) {
    this.versionPattern = versionPattern;
  }

  /**
   * Returns whether debug (non-production) is switch on.
   * @return
   */
  public boolean isDebugEnabled() {
    return debugEnabled;
  }

  public void setDebugEnabled(boolean debug) {
    this.debugEnabled = debug;
  }

  /**
   * Returns where the jbpm scheduler is enabled.
   * @return
   */
  public boolean isSchedulerEnabled() {
    return schedulerEnabled;
  }

  public void setSchedulerEnabled(boolean schedulerEnabled) {
    this.schedulerEnabled = schedulerEnabled;
  }    
  
  /**
   * Prevents the default jbpm component from installing all processes. 
   */
  @Override
  protected boolean isProcessDeploymentEnabled() {
    return false ;
  }
  
  /**
   * Overrides the default component to use conditional deployment.
   */
  @Override
  public void startup() throws Exception {
    log.info("Using jBPM extensions. debug #0, dependencyHandling #1, scheduler #2", isDebugEnabled() ? "enabled" : "disabled", isWorkflowDependenciesEnabled() ? "enabled" : "disabled", isSchedulerEnabled() ? "enabled" : "disabled") ;
    super.startup();

    versionHandler = new VersionHandler( getVersionPattern() ) ;
    processDescriptors = new HashMap&lt;String, ProcessDescriptor&gt;() ;
    
    // work around to let Seam know jbpm is actually installed.
    Init.instance().setJbpmInstalled(true) ;
    
    // let the user know if nothing was deployed.
    if ( !installProcessDefinitions() ) {
      log.info("No process definitions have changed, so nothing was deployed.") ;
    }
    
    if (isSchedulerEnabled()) {

      log.info("Starting the jBPM scheduler");
      
      startScheduler() ;
      
      if (isRunning()) {
        log.info("jBPM scheduler has started.");
      } else {
        log.error("jBPM scheduler was not started.") ;
      }
      
    }
    
  }
  
  /**
   * Go through each process definition and conditionally deploy it.
   * 
   * @return true if at least one process definition was deploy, false otherwise.
   */
  private boolean installProcessDefinitions() {
    boolean installed = false ;
    JbpmContext jbpmContext = getJbpmConfiguration().createJbpmContext();
    try {
      if (getProcessDefinitions() != null) {
        
        for (String definitionResource : getProcessDefinitions()) {
          if (isDebugEnabled()) {
            // If debug is enabled, process definitions are always deployed.
            // Note: in order to maintain consistent versioning,
            // jbpm tables ought to be cleared out when switching from debug to production
            jbpmContext.deployProcessDefinition( ProcessDefinition.parseXmlResource(definitionResource) ) ;
            installed = true ;
            log.info("Debug mode enabled - deploying process definition: #0", definitionResource);
          } else {
            ProcessDescriptor processDescriptor = new ProcessDescriptor(jbpmContext, definitionResource) ; 
            boolean deployed = processDescriptor.deploy(jbpmContext) ;
            if (!deployed &amp;&amp; workflowDependenciesEnabled) {
              // save for later in case we need to redeploy everything (i.e. assume dependencies)
              processDescriptors.put(processDescriptor.getFileProcess().getName(), processDescriptor) ;
            }
            installed = installed || deployed ;
          }
        }

        // at least one process has deployed, so deploy the others 
        if (!isDebugEnabled() &amp;&amp; installed &amp;&amp; !processDescriptors.isEmpty()) {
          for (ProcessDescriptor pd : processDescriptors.values()) {
            // force redeployment
            pd.deploy(jbpmContext, true) ;
          }
        }
        
      }
      return installed ;
    } catch (Exception e) {
      jbpmContext.getSession().getTransaction().rollback() ;
      throw new RuntimeException("Could not deploy a process definition.", e);
    } finally {
      jbpmContext.close();
    }
  }
  
  /**
   * Returns the jbpm job executor.
   */
  public JobExecutor getJobExecutor() {
    return getJbpmConfiguration().getJobExecutor() ;
  }
  
  /**
   * Starts the jbpm scheduler
   */
  private void startScheduler() {
    JobExecutor jobExecutor = getJobExecutor() ;
    if (jobExecutor != null) {
      jobExecutor.start() ;
    }
  }
  
  /**
   * Stops the jbpm scheduler.
   */
  private void stopScheduler() {
    JobExecutor jobExecutor = getJobExecutor() ;
    if (jobExecutor != null) {
      try {
        jobExecutor.stopAndJoin() ;
      } catch (InterruptedException e) {
        log.warn( "Could not wait for job executor.", e ) ;
      }
    }
  }  
  /**
   * Returns true if the jbpm scheduler is running.
   * @return
   */
  private boolean isRunning() {
    return getJobExecutor() != null &amp;&amp; getJobExecutor().isStarted() ;
  }
  
  /**
   * Overridden to stop the jbpm scheduler if its running.
   */
  @Override
  public void shutdown() {
    if (isRunning()) {
      log.info("Stopping the jBPM scheduler.");
      stopScheduler() ;
    } else if ( isSchedulerEnabled() ){
      log.debug("jBPM Scheduler can't be stopped because it was not running.");
    }
    super.shutdown() ;
  }
  public boolean isWorkflowDependenciesEnabled() {
    return workflowDependenciesEnabled;
  }
  
  /**
   * Set to true to try and work around early binding of jbpm (experimental). Set to false if
   * no dependencies occur in the workflow or if late binding attribute is used. 
   * @param workflowDependenciesEnabled
   */
  public void setWorkflowDependenciesEnabled(boolean workflowDependenciesEnabled) {
    this.workflowDependenciesEnabled = workflowDependenciesEnabled;
  }  
  
}</pre> </li>
        </ol> 
       </div>
       <div id="j_id367" class="documentTags undecoratedLink smallFont">
        <div id="j_id368">
          Tags:&nbsp;
         <a href="https://community.jboss.org/tags?recursive=true#/?tags=deployment">deployment</a>&nbsp;|&nbsp;
         <a href="https://community.jboss.org/tags?recursive=true#/?tags=integration">integration</a>&nbsp;|&nbsp;
         <a href="https://community.jboss.org/tags?recursive=true#/?tags=jbpm">jbpm</a>&nbsp;|&nbsp;
         <a href="https://community.jboss.org/tags?recursive=true#/?tags=production">production</a>
        </div>
       </div>
       <div id="j_id374" class="documentCreatorHistory undecoratedLink smallFont">
        <div id="j_id375">
          Created:&nbsp;27. Jun 2008, 09:03&nbsp;America/New_York&nbsp;(Peter Brewer)
        </div>
        <div id="j_id383">
          Last Modified:&nbsp;19. Sep 2011, 06:53&nbsp;America/New_York&nbsp;(Shane Bryzak)
        </div>
       </div> 
      </div>
      <div id="commentDisplayForm">
       <div id="comments" class="commentsDisplay"></div>
      </div> 
     </div> 
     <div class="clear" style="padding-top:15px;"></div> 
    </div>
   </div> 
  </div> 
  <div id="footer" class="undecoratedLink"> 
   <p> © Copyright 2009, Red Hat Middleware, LLC. All rights reserved. JBoss and Seam are registered trademarks and servicemarks of <a href="http://www.redhat.com/">Red Hat, Inc</a>. [<a href="http://www.redhat.com/legal/privacy_statement.html">Privacy Policy</a>]</p> 
  </div>
  <div id="status">
   <span id="globalStatus"><span id="globalStatus.start" style="display: none">
     <div id="j_id608" class="statusStart">
      <img src="../themes/sfwkorg/img/statusindicator.gif" height="25" width="20">
     </div></span><span id="globalStatus.stop">
     <div id="j_id610" class="statusStop">
      <img src="../themes/sfwkorg/img/blank.gif" height="25" width="20">
     </div></span></span>
  </div>  
  <!-- Mirrored from 127.0.0.1:64444/Documentation/JBPMDeploymentInProductionEnvironments by HTTrack Website Copier/3.x [XR&CO'2008], Wed, 01 Oct 2014 13:47:32 GMT --> 
  <!-- Added by HTTrack -->
  <meta http-equiv="content-type" content="text/html;charset=UTF-8">
  <!-- /Added by HTTrack --> 
 </body>
</html>